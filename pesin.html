<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DepoTech - PeÅŸin SatÄ±ÅŸ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --green: #1A6B3B;
      --light-green: #2E8B57;
      --orange: #FF9800;
      --gray: #F5F5F5;
      --dark: #333;
    }
    body { font-family: 'Segoe UI', sans-serif; margin:0; background:var(--gray); }
    .header { background:var(--green); color:#fff; display:flex; align-items:center; justify-content:space-between; padding:10px 20px; }
    .back-button { background:#fff; color:var(--green); border:none; padding:8px 14px; border-radius:4px; font-weight:bold; cursor:pointer; }
    .container { padding:15px; }
    .top-grid { display:grid; grid-template-columns:1fr 1fr 1fr; gap:15px; }
    .panel { background:#fff; border-radius:6px; padding:12px 16px; box-shadow:0 1px 3px rgba(0,0,0,0.1); }
    .panel-title { border-bottom:2px solid var(--light-green); padding-bottom:5px; margin-bottom:8px; color:var(--light-green); }
    .para-sayi-grid, .kasa-durum-grid, .duzeltme-grid, .satis-table-header { display:grid; grid-template-columns:1fr 1fr 1fr; gap:5px; margin-bottom:5px; align-items:center; }
    .satis-table-header { font-weight:bold; background:#e9e9e9; padding:6px; border-radius:4px; grid-template-columns:1.2fr 2fr 1fr 1fr 1fr 40px; }
    .form-control { width:100%; padding:4px; box-sizing:border-box; border:1px solid #ccc; border-radius:3px; text-align:right; }
    .total-row label { font-weight:bold; }
    .btn { padding:6px 12px; border:none; border-radius:4px; cursor:pointer; font-weight:bold; }
    .btn-primary { background:var(--green); color:white; }
    .btn-add-fis { background:none; color:var(--green); border:none; cursor:pointer; font-weight:bold; }
    .btn-add-fis i { margin-right:5px; }
    .satis-row { display:grid; grid-template-columns:1.2fr 2fr 1fr 1fr 1fr 40px; gap:5px; align-items:center; margin-top:5px; }
    .satis-row button { background:#e74c3c; color:white; border:none; border-radius:4px; cursor:pointer; }
    .kasa-buton-grup { display:flex; gap:8px; margin-top:10px; }
  </style>
</head>

<body>
  <div class="header">
    <button class="back-button" onclick="window.location.href='index.html'"><i class="fas fa-arrow-left"></i> Ana MenÃ¼</button>
    <h1>PeÅŸin SatÄ±ÅŸ</h1>
    <div></div>
  </div>

  <div class="container">
    <div class="top-grid">
      <!-- PARA SAYILARI -->
      <div class="panel">
        <h3 class="panel-title">Para SayÄ±larÄ±</h3>
        <div class="para-sayi-grid" style="font-weight:bold;">
          <label>Banknot</label><label>Adet</label><label>Toplam</label>
        </div>
        <div id="paraSayiContainer"></div>
        <div class="para-sayi-grid total-row"><label>TOPLAM</label><div></div><input id="paraSayilariToplam" class="form-control" readonly></div>
      </div>

      <!-- KASA DURUMU -->
      <div class="panel">
        <h3 class="panel-title">Kasa Durumu</h3>
        <div class="kasa-durum-grid"><label>Nakit SatÄ±ÅŸ ToplamÄ±</label><input id="nakitSatisKasaDurumu" class="form-control" readonly></div>
        <div class="kasa-durum-grid"><label>Kasa ToplamÄ±</label><input id="kasaToplami" class="form-control" readonly></div>
        <div class="kasa-durum-grid"><label>Kasa Bakiyesi</label><input type="number" id="kasaBakiyesi" class="form-control" oninput="runAllCalculations()"></div>
        <div class="kasa-durum-grid"><label>Durum</label><input id="kasaDurum" class="form-control" readonly></div>
        <div><label>AÃ§Ä±klama</label><div id="kasaDurumAciklama" class="form-control" style="text-align:center;color:#fff;background:#e74c3c;display:none;"></div></div>
        <div class="kasa-buton-grup">
          <button class="btn" style="background:var(--orange);color:white;"><i class="fas fa-print"></i> YazdÄ±r</button>
          <button class="btn btn-primary"><i class="fas fa-save"></i> Kaydet</button>
        </div>
      </div>

      <!-- DÃœZELTME KAYITLARI -->
      <div class="panel">
        <h3 class="panel-title">DÃ¼zeltme KayÄ±tlarÄ±</h3>
        <div class="duzeltme-grid" style="font-weight:bold;"><label>AÃ§Ä±klama</label><label>Tutar</label></div>
        <div id="duzeltmeContainer"></div>
        <div class="duzeltme-grid total-row"><label>DÃ¼zeltme KayÄ±tlarÄ± ToplamÄ±</label><input id="duzeltmeKayitlariToplam" class="form-control" readonly></div>
        <div class="duzeltme-grid total-row"><label>Nakit SatÄ±ÅŸ ToplamÄ±</label><input id="nakitSatisDuzeltme" class="form-control" readonly></div>
      </div>
    </div>

    <!-- SATIÅ KAYITLARI -->
    <div class="panel" style="margin-top:15px;">
      <div class="satis-header" style="display:flex;justify-content:space-between;align-items:center;">
        <h3 class="panel-title" style="margin:0;">SatÄ±ÅŸ KayÄ±tlarÄ±</h3>
        <button id="btnAddSatisRow" class="btn-add-fis"><i class="fas fa-plus"></i> SatÄ±r Ekle</button>
      </div>
      <div class="satis-table-header">
        <div>Stok Kodu</div><div>Stok AdÄ±</div><div>Miktar</div><div>Birim Fiyat</div><div>Toplam</div><div></div>
      </div>
      <div id="satisKayitlariContainer"></div>
    </div>
  </div>

  <script>
    // === PARA SAYILARI OLUÅTUR ===
    const banknotlar = [200,100,50,20,10,5,1,0.5,0.25];
    const paraDiv = document.getElementById("paraSayiContainer");
    banknotlar.forEach(b=>{
      const row=document.createElement("div");
      row.className="para-sayi-grid";
      row.innerHTML=`
        <input class="form-control" readonly value="${b}">
        <input type="number" id="adet${b}" class="form-control" oninput="runAllCalculations()">
        <input id="toplam${b}" class="form-control" readonly>`;
      paraDiv.appendChild(row);
    });

    // === DÃœZELTME SATIRLARI OLUÅTUR ===
    const duzDiv=document.getElementById("duzeltmeContainer");
    for(let i=0;i<8;i++){
      const r=document.createElement("div");
      r.className="duzeltme-grid";
      r.innerHTML=`<input class="form-control" placeholder="AÃ§Ä±klama..."><input type="number" class="form-control" oninput="runAllCalculations()">`;
      duzDiv.appendChild(r);
    }

    // === SATIÅ KAYITLARI ===
    const container=document.getElementById("satisKayitlariContainer");
    document.getElementById("btnAddSatisRow").onclick=()=>addRow();
    function addRow(){
      const wrap=document.createElement("div");
      wrap.className="satis-row";
      wrap.innerHTML=`
        <input class="form-control" placeholder="Kod">
        <input class="form-control" placeholder="ÃœrÃ¼n AdÄ±">
        <input type="number" class="form-control" placeholder="Miktar" oninput="calcRow(this)">
        <input type="number" class="form-control" placeholder="Birim Fiyat" oninput="calcRow(this)">
        <input class="form-control" readonly placeholder="Toplam">
        <button onclick="this.parentElement.remove()">ğŸ—‘ï¸</button>`;
      container.appendChild(wrap);
    }
    function calcRow(el){
      const row=el.parentElement;
      const m=Number(row.children[2].value||0);
      const f=Number(row.children[3].value||0);
      row.children[4].value=(m*f).toFixed(2);
      runAllCalculations();
    }

    // === HESAPLAMA ===
    function runAllCalculations(){
      // Para toplamÄ±
      let paraTop=0;
      banknotlar.forEach(b=>{
        const adet=Number(document.getElementById(`adet${b}`)?.value||0);
        const toplam=adet*b;
        document.getElementById(`toplam${b}`).value=toplam.toFixed(2);
        paraTop+=toplam;
      });
      document.getElementById("paraSayilariToplam").value=paraTop.toFixed(2);

      // DÃ¼zeltme toplamÄ±
      let duzTop=0;
      duzDiv.querySelectorAll("input[type=number]").forEach(i=>duzTop+=Number(i.value||0));
      document.getElementById("duzeltmeKayitlariToplam").value=duzTop.toFixed(2);

      // SatÄ±ÅŸ toplamÄ±
      let satisTop=0;
      container.querySelectorAll(".satis-row").forEach(r=>{
        satisTop+=Number(r.children[4].value||0);
      });
      document.getElementById("nakitSatisDuzeltme").value=satisTop.toFixed(2);
      document.getElementById("nakitSatisKasaDurumu").value=satisTop.toFixed(2);

      // Kasa toplam ve durum
      const kasaBakiyesi=Number(document.getElementById("kasaBakiyesi").value||0);
      const kasaToplami=paraTop+duzTop;
      document.getElementById("kasaToplami").value=kasaToplami.toFixed(2);
      const durum=kasaToplami - kasaBakiyesi;
      document.getElementById("kasaDurum").value=durum.toFixed(2);
      const aciklama=document.getElementById("kasaDurumAciklama");
      if(durum<0){aciklama.style.display="block";aciklama.style.background="#e74c3c";aciklama.textContent=`${durum.toFixed(2)} TL Kasa HesabÄ± Eksik`;}
      else if(durum>0){aciklama.style.display="block";aciklama.style.background="#27ae60";aciklama.textContent=`${durum.toFixed(2)} TL Kasa Fazla`;}
      else aciklama.style.display="none";
    }
    const API = "https://script.google.com/macros/s/AKfycbzY7jYafKU-DuUBUqq6vj89_sLKSbCmT8c-Fen77HnxB1h7Ji7HzCZmKH8LQMZCz-04/exec";

window.addEventListener("DOMContentLoaded", async () => {
  const res = await fetch(`${API}?action=getPesinRows`);
  const j = await res.json();
  if (!j.success || !j.rows) return;

  j.rows.forEach(r => {
    const wrap=document.createElement("div");
    wrap.className="satis-row";
    wrap.innerHTML=`
      <input class="form-control" value="${r.code||''}">
      <input class="form-control" value="${r.name||''}">
      <input type="number" class="form-control" value="${r.qty||0}" oninput="calcRow(this)">
      <input type="number" class="form-control" value="${r.price||0}" oninput="calcRow(this)">
      <input class="form-control" readonly value="${r.total||0}">
      <button onclick="this.parentElement.remove()">ğŸ—‘ï¸</button>`;
    document.getElementById("satisKayitlariContainer").appendChild(wrap);
  });
  runAllCalculations();
});

  </script>
</body>
</html>
